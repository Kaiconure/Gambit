{
  "about": {
    "author": "@Kaiconure",
    "notes": [
      "Place this at the very top of your battle section, or at least above any gambit that will turn or move toward the mob.",
      "This will cause you to turn and face away from the mob when certain spells are being used, and then turn when casting completes."
    ]
  },
  "vars": {
    "face_away_on_spell": {
      "spells": null,
      "mobs": null
    }
  },
  "actions": [
    {
      "commands": [
        "setVar('vars.face_away_on_spell.triggered', false)",
        "setVar('vars.face_away_on_spell._spells', vars.face_away_on_spell[bt.name] and vars.face_away_on_spell[bt.name].spells or vars.face_away_on_spell.spells)",
        "setVar('vars.face_away_on_spell._wait', vars.face_away_on_spell[bt.name] and vars.face_away_on_spell[bt.name].wait or vars.face_away_on_spell.wait or 3)"
      ],
      "delay": 0,
      "frequency": "infinity",
      "scope": "battle",
      "comment": "This will run exactly once at the start of any battle, and ensure that the face_away_on_spell.triggered flag cleared and that the right set is loaded."
    },
    {
      "when": ["vars.face_away_on_spell.triggered", "not enemyCastingSpell()"],
      "commands": [
        "setVar('vars.face_away_on_spell.triggered', false)",
        "wait(vars.face_away_on_spell._wait)",
        "resumeBlackMagic()",
        "log('====== END SPELL FACE-AWAY SEQUENCE ====== ')"
      ],
      "delay": 0
    },
    {
      "when": [
        "not vars.face_away_on_spell.triggered",
        "arrayLength(vars.face_away_on_spell._spells) >= 0 and enemyCastingSpell(vars.face_away_on_spell._spells)"
      ],
      "commands": [
        "faceAway(bt)",
        "setVar('vars.face_away_on_spell.triggered', true)",
        "suppressBlackMagic()",
        "log('====== BEGIN SPELL FACE-AWAY SEQUENCE ====== ')",
        "wait(2)"
      ],
      "delay": 0
    },
    {
      "when": "vars.face_away_on_spell.triggered",
      "commands": [
        "log('Continuing spell face-away...')",
        "faceAway(bt)",
        "wait(2)"
      ],
      "delay": 0
    }
  ]
}
